{"version":3,"sources":["../../../src/helpers/LbdConcept.ts"],"names":["LbdConcept","constructor","fetch","registry","id","url","accessService","AccessService","dataService","DataService","queryEngine","create","q0","LBD","Concept","sparqlUpdate","delete","addReference","identifier","dataset","distribution","referenceId","referenceUrl","identifierId","identifierUrl","formatted","identifierType","getIdentifierType","hasReference","inDataset","hasIdentifier","q1","inDistribution","deleteReference","console","log","addAlias","isInt","n","startsWith","URIBasedIdentifier","XSD","integer","StringBasedIdentifier","float","string"],"mappings":"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","sourcesContent":["import AccessService from \"./access-service\";\nimport DataService from \"./data-service\";\nimport { newEngine, IQueryResultBindings, ActorInitSparql } from \"@comunica/actor-init-sparql\";\n\nimport LBD from \"./vocab/lbd\";\nimport { AccessRights, ResourceType } from \"./BaseDefinitions\";\nimport LBDService from \"./LbdService\";\nimport {extract} from \"jsonld-remote\"\nimport {v4} from \"uuid\"\nimport { DCAT, DCTERMS, RDFS, XSD } from \"@inrupt/vocab-common-rdf\";\nimport mime from \"mime-types\"\n\nexport default class LbdConcept {\n  public fetch;\n  public accessService: AccessService;\n  public dataService: DataService;\n  public datasetUrl: string;\n  public registry: string;\n  public id: string;\n  public concept: string;\n\n  // include queryEngine to allow caching of querydata etc.\n  public queryEngine: ActorInitSparql;\n  public url: string;\n\n  constructor(fetch: any, registry, id: string = v4()) {\n    this.registry = registry;\n    this.id = id;\n    this.url = this.registry + this.id\n    this.fetch = fetch;\n    this.accessService = new AccessService(fetch);\n    this.dataService = new DataService(fetch);\n    this.queryEngine = newEngine();\n  }\n\n  public async create() {\n    const q0 = `INSERT DATA {<${this.url}> a <${LBD.Concept}> }`\n    await this.dataService.sparqlUpdate(this.registry, q0)\n  }\n\n  public async delete() {\n    const q0 = `DELETE {\n      <${this.url}> ?p ?o .\n    } WHERE {\n      <${this.url}> ?p ?o .\n    }`\n    await this.dataService.sparqlUpdate(this.registry, q0)\n  }\n\n  public async addReference(identifier: string, dataset: string, distribution?: string) {\n    const referenceId = v4()\n    const referenceUrl = this.registry + referenceId\n    const identifierId = v4()\n    const identifierUrl = this.registry + identifierId\n\n    const {formatted, identifierType} = this.getIdentifierType(identifier)\n\n    const q0 = `INSERT DATA {\n      <${this.url}> <${LBD.hasReference}> <${referenceUrl}> .\n      <${referenceUrl}> <${LBD.inDataset}> <${dataset}> ;\n        <${LBD.hasIdentifier}> <${identifierUrl}> .\n      <${identifierUrl}> a <${identifierType}> ;\n        <${LBD.identifier}> ${formatted} .\n   }`\n    \n    if (distribution) {\n      const q1 = `INSERT DATA {\n        <${identifierUrl}> <${LBD.inDistribution}> <${distribution}> ;\n      }`\n    }\n\n    await this.dataService.sparqlUpdate(this.registry, q0)\n    await this.dataService.sparqlUpdate(this.registry, q0)\n\n    return referenceUrl\n  }\n\n  public async deleteReference(referenceUrl) {\n    const q0 = `DELETE {\n      ?a ?b <${referenceUrl}> .\n      <${referenceUrl}> ?p ?o ; ?q ?x.\n      ?x ?y ?z.\n    } WHERE {\n      ?a ?b <${referenceUrl}> .\n      <${referenceUrl}> ?p ?o ; ?q ?x.\n      ?x ?y ?z.\n    }`\n    console.log('q0', q0);\n    await this.dataService.sparqlUpdate(this.registry, q0)\n\n    const q1 = `DELETE {<${this.url}> <${LBD.hasReference}> <${referenceUrl}> .}`\n    await this.dataService.sparqlUpdate(this.registry, q1)\n  }\n\n  public async addAlias() {\n\n  }\n\n  private getIdentifierType(identifier: string | number) {\n    function isInt(n) {\n      return n % 1 === 0;\n   }\n\n    if (typeof identifier === \"string\" && identifier.startsWith(\"http\")) {\n      return {formatted: `<${identifier}>`, identifierType: LBD.URIBasedIdentifier}\n    } else {\n      if (typeof identifier === \"number\") {\n        if (isInt(identifier)) {\n          return {formatted: `\"${identifier}\"^^<${XSD.integer}>`, identifierType: LBD.StringBasedIdentifier}\n        } else {\n          return {formatted: `\"${identifier}\"^^<${XSD.float}>`, identifierType: LBD.StringBasedIdentifier}\n        }\n      } else {\n        return {formatted: `\"${identifier}\"^^<${XSD.string}>`, identifierType: LBD.StringBasedIdentifier}\n      }\n    }\n  }\n\n}\n\n"],"file":"LbdConcept.js"}