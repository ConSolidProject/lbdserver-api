{"version":3,"sources":["../../../src/helpers/LbdConcept.ts"],"names":["LbdConcept","constructor","fetch","registry","id","distribution","url","accessService","AccessService","dataService","DataService","queryEngine","create","q0","LBD","Concept","sparqlUpdate","delete","addReference","identifier","dataset","referenceId","referenceUrl","identifierId","identifierUrl","formatted","identifierType","getIdentifierType","hasReference","inDataset","hasIdentifier","q1","inDistribution","deleteReference","console","log","addAlias","isInt","n","startsWith","URIBasedIdentifier","XSD","integer","StringBasedIdentifier","float","string"],"mappings":"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","sourcesContent":["import AccessService from \"./access-service\";\nimport DataService from \"./data-service\";\nimport { newEngine, IQueryResultBindings, ActorInitSparql } from \"@comunica/actor-init-sparql\";\n\nimport LBD from \"./vocab/lbd\";\nimport { AccessRights, ResourceType } from \"./BaseDefinitions\";\nimport LBDService from \"./LbdService\";\nimport {extract} from \"jsonld-remote\"\nimport {v4} from \"uuid\"\nimport { DCAT, DCTERMS, RDFS, XSD } from \"@inrupt/vocab-common-rdf\";\nimport mime from \"mime-types\"\n\nexport default class LbdConcept {\n  public fetch;\n  public accessService: AccessService;\n  public dataService: DataService;\n  public datasetUrl: string;\n  public registry: string;\n  public id: string;\n  public concept: string;\n  public distribution: string; \n\n  // include queryEngine to allow caching of querydata etc.\n  public queryEngine: ActorInitSparql;\n  public url: string;\n\n  constructor(fetch: any, registry, id: string = v4()) {\n    this.registry = registry;\n    this.distribution = registry + \"data\"\n    this.id = id;\n    this.url = this.distribution + \"#\" + this.id\n    this.fetch = fetch;\n    this.accessService = new AccessService(fetch);\n    this.dataService = new DataService(fetch);\n    this.queryEngine = newEngine();\n  }\n\n  public async create() {\n    const q0 = `INSERT DATA {<${this.url}> a <${LBD.Concept}> }`\n    await this.dataService.sparqlUpdate(this.distribution, q0)\n  }\n\n  public async delete() {\n    const q0 = `DELETE {\n      <${this.url}> ?p ?o .\n    } WHERE {\n      <${this.url}> ?p ?o .\n    }`\n    await this.dataService.sparqlUpdate(this.distribution, q0)\n  }\n\n  public async addReference(identifier: string, dataset: string, distribution?: string) {\n    const referenceId = v4()\n    const referenceUrl = this.distribution + \"#\" + referenceId\n    const identifierId = v4()\n    const identifierUrl = this.distribution + \"#\" + identifierId\n\n    const {formatted, identifierType} = this.getIdentifierType(identifier)\n\n    const q0 = `INSERT DATA {\n      <${this.url}> <${LBD.hasReference}> <${referenceUrl}> .\n      <${referenceUrl}> <${LBD.inDataset}> <${dataset}> ;\n        <${LBD.hasIdentifier}> <${identifierUrl}> .\n      <${identifierUrl}> a <${identifierType}> ;\n        <${LBD.identifier}> ${formatted} .\n   }`\n    \n    if (distribution) {\n      const q1 = `INSERT DATA {\n        <${identifierUrl}> <${LBD.inDistribution}> <${distribution}> ;\n      }`\n    }\n\n    await this.dataService.sparqlUpdate(this.distribution, q0)\n    await this.dataService.sparqlUpdate(this.distribution, q0)\n\n    return referenceUrl\n  }\n\n  public async deleteReference(referenceUrl) {\n    const q0 = `DELETE {\n      ?a ?b <${referenceUrl}> .\n      <${referenceUrl}> ?p ?o ; ?q ?x.\n      ?x ?y ?z.\n    } WHERE {\n      ?a ?b <${referenceUrl}> .\n      <${referenceUrl}> ?p ?o ; ?q ?x.\n      ?x ?y ?z.\n    }`\n    console.log('q0', q0);\n    await this.dataService.sparqlUpdate(this.distribution, q0)\n\n    const q1 = `DELETE {<${this.url}> <${LBD.hasReference}> <${referenceUrl}> .}`\n    await this.dataService.sparqlUpdate(this.distribution, q1)\n  }\n\n  public async addAlias() {\n\n  }\n\n  private getIdentifierType(identifier: string | number) {\n    function isInt(n) {\n      return n % 1 === 0;\n   }\n\n    if (typeof identifier === \"string\" && identifier.startsWith(\"http\")) {\n      return {formatted: `<${identifier}>`, identifierType: LBD.URIBasedIdentifier}\n    } else {\n      if (typeof identifier === \"number\") {\n        if (isInt(identifier)) {\n          return {formatted: `\"${identifier}\"^^<${XSD.integer}>`, identifierType: LBD.StringBasedIdentifier}\n        } else {\n          return {formatted: `\"${identifier}\"^^<${XSD.float}>`, identifierType: LBD.StringBasedIdentifier}\n        }\n      } else {\n        return {formatted: `\"${identifier}\"^^<${XSD.string}>`, identifierType: LBD.StringBasedIdentifier}\n      }\n    }\n  }\n\n}\n\n"],"file":"LbdConcept.js"}