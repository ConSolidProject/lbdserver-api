{"version":3,"sources":["../../../src/helpers/data-service.ts"],"names":["DataService","constructor","fetch","verbose","accessService","AccessService","writeFileToPod","file","targetFileURL","makePublic","contentType","requestOptions","method","headers","body","redirect","makeFilePublic","getFile","fileURL","console","log","deleteFile","sparqlUpdate","fileUrl","query","deleteContainer","containerURL","includeSubContainers","dataset","containerResources","resource","createContainer","datasetWithAcl"],"mappings":";;;;;;;AACA;;AAWA;;;;;;;;;;AAGe,MAAMA,WAAN,CAAiB;AAM5BC,EAAAA,WAAW,CAACC,KAAD,EAAsC;AAAA,QAAzBC,OAAyB,uEAAN,KAAM;;AAAA,qCAHvB,KAGuB;;AAC7C,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKC,aAAL,GAAqB,IAAIC,sBAAJ,CAAkBH,KAAlB,CAArB;AACH;AAED;AACJ;AACA;AAEI;AACA;AACA;;;AACaI,EAAAA,cAAc,CAACC,IAAD,EAAoBC,aAApB,EAA6F;AAAA;AAAA;;AAAA;AAAA,UAAlDC,UAAkD,0EAA5B,KAA4B;AAAA,UAArBC,WAAqB;AAEpH,UAAIC,cAAc,GAAG;AACjBC,QAAAA,MAAM,EAAE,KADS;AAEjBC,QAAAA,OAAO,EAAE;AACP,0BAAgBH;AADT,SAFQ;AAKjBI,QAAAA,IAAI,EAAEP,IALW;AAMjBQ,QAAAA,QAAQ,EAAE;AANO,OAArB;AAQE,YAAM,KAAI,CAACb,KAAL,CAAWM,aAAX,EAA0BG,cAA1B,CAAN,CAVkH,CAapH;AACA;AACA;AACA;AACA;AACA;;AAEA,UAAGF,UAAH,EAAc;AACV,cAAM,KAAI,CAACL,aAAL,CAAmBY,cAAnB,CAAkCR,aAAlC,CAAN;AACH,OAtBmH,CAwBpH;;AAxBoH;AA0BvH;;AAGYS,EAAAA,OAAO,CAACC,OAAD,EAAkB;AAAA;;AAAA;AAClC,MAAA,MAAI,CAACf,OAAL,IAAgBgB,OAAO,CAACC,GAAR,wBAA4BF,OAA5B,SAAhB;AACA,aAAO,0BACHA,OADG,EACqB;AACxB;AAAEhB,QAAAA,KAAK,EAAE,MAAI,CAACA;AAAd,OAFG,CAEqB;AAFrB,OAAP;AAFkC;AAMrC;;AAEYmB,EAAAA,UAAU,CAACH,OAAD,EAAkB;AAAA;;AAAA;AACrC,MAAA,MAAI,CAACf,OAAL,IAAgBgB,OAAO,CAACC,GAAR,yBAA6BF,OAA7B,SAAhB;AACA,aAAO,6BACHA,OADG,EACqB;AACxB;AAAEhB,QAAAA,KAAK,EAAE,MAAI,CAACA;AAAd,OAFG,CAEqB;AAFrB,OAAP;AAFqC;AAMxC;AAED;AACJ;AACA;;;AACiBoB,EAAAA,YAAY,CAACC,OAAD,EAAkBC,KAAlB,EAAiC;AAAA;;AAAA;AAC1D,UAAIb,cAAc,GAAG;AACjBC,QAAAA,MAAM,EAAE,OADS;AAEjBC,QAAAA,OAAO,EAAE;AAAE,0BAAgB;AAAlB,SAFQ;AAGjBC,QAAAA,IAAI,EAAEU,KAHW;AAIjBT,QAAAA,QAAQ,EAAE;AAJO,OAArB;AAOI,mBAAa,MAAI,CAACb,KAAL,CAAWqB,OAAX,EAAoBZ,cAApB,CAAb;AARsD;AASzD;AAGD;AACJ;AACA;;;AAEiBc,EAAAA,eAAe,CAACC,YAAD,EAA6D;AAAA;AAAA;;AAAA;AAAA,UAAtCC,oBAAsC,6EAAN,IAAM;;AAErF;AACA,UAAGA,oBAAH,EAAwB;AACpBR,QAAAA,OAAO,CAACC,GAAR,8BAAkCM,YAAlC;AACA,YAAME,OAAO,SAAS,kCAAiBF,YAAjB,EAA+B;AAAExB,UAAAA,KAAK,EAAE,MAAI,CAACA;AAAd,SAA/B,CAAtB;AACA,YAAM2B,kBAAkB,SAAS,6CAA4BD,OAA5B,CAAjC,CAHoB,CAKpB;;AACA,aAAI,IAAIE,QAAR,IAAoBD,kBAApB,EAAuC;AACnC,cAAG,8BAAYC,QAAZ,CAAH,EAAyB;AACrB,kBAAM,MAAI,CAACL,eAAL,CAAqBK,QAArB,EAA+B,IAA/B,CAAN;AACH,WAFD,MAGI;AACA,kBAAM,MAAI,CAACT,UAAL,CAAgBS,QAAhB,CAAN;AACH;AACJ;AACJ;;AAEDX,MAAAA,OAAO,CAACC,GAAR,8BAAkCM,YAAlC;AACA,aAAO,kCAAiBA,YAAjB,EAA+B;AAAExB,QAAAA,KAAK,EAAE,MAAI,CAACA;AAAd,OAA/B,CAAP;AApBqF;AAsBxF;;AAEY6B,EAAAA,eAAe,CAACL,YAAD,EAAoD;AAAA;AAAA;;AAAA;AAAA,UAA7BjB,UAA6B,6EAAP,KAAO;AAE5E,MAAA,MAAI,CAACN,OAAL,IAAgBgB,OAAO,CAACC,GAAR,8BAAkCM,YAAlC,SAAhB;AAEA,UAAMM,cAAc,SAAS,oCACzBN,YADyB,EACD;AACxB;AAAExB,QAAAA,KAAK,EAAE,MAAI,CAACA;AAAd,OAFyB,CAED;AAFC,OAA7B;;AAKA,UAAGO,UAAH,EAAc;AACV,cAAM,MAAI,CAACL,aAAL,CAAmBK,UAAnB,CAA8BiB,YAA9B,CAAN;AACH;;AAED,aAAOM,cAAP;AAb4E;AAc/E;;AAzH2B","sourcesContent":["// Import from \"@inrupt/solid-client\"\nimport {\n    getSolidDataset,\n    getFile,\n    createContainerAt,\n    deleteFile,\n    deleteContainer,\n    getContainedResourceUrlAll,\n    overwriteFile,\n    getSourceUrl,\n    isContainer\n} from \"@inrupt/solid-client\";\nimport AccessService from \"./access-service\";\nimport { Mimetype } from \"./BaseDefinitions\";\n\nexport default class DataService{\n\n    public fetch;\n    public verbose: boolean = false;\n    public accessService: AccessService;\n\n    constructor(fetch: any, verbose: boolean = false){\n        this.fetch = fetch;\n        this.verbose = verbose;\n        this.accessService = new AccessService(fetch);\n    }\n\n    /**\n     * FILES\n     */\n\n    // Upload File to the targetFileURL.\n    // If the targetFileURL exists, overwrite the file.\n    // If the targetFileURL does not exist, create the file at the location.\n    public async writeFileToPod(file: File|Buffer, targetFileURL: string, makePublic: boolean = false, contentType: string) {\n\n        var requestOptions = {\n            method: \"PUT\",\n            headers: {\n              \"Content-Type\": contentType,\n            },\n            body: file,\n            redirect: \"follow\",\n          };\n          await this.fetch(targetFileURL, requestOptions);\n\n\n        // const savedFile = await overwriteFile(\n        //   targetFileURL,                            // URL for the file.\n        //   file,                                     // File\n        //   { contentType, fetch: this.fetch }        // mimetype if known, fetch from the authenticated session\n        // );\n        // this.verbose && console.log(`File saved at ${getSourceUrl(savedFile)}`);\n\n        if(makePublic){\n            await this.accessService.makeFilePublic(targetFileURL);\n        }\n\n        // return savedFile;\n\n    }\n\n\n    public async getFile(fileURL: string) {\n        this.verbose && console.log(`Getting file ${fileURL}...`);\n        return getFile(\n            fileURL,                // File in Pod to Read\n            { fetch: this.fetch }   // fetch from authenticated session\n        );\n    }\n\n    public async deleteFile(fileURL: string) {\n        this.verbose && console.log(`Deleting file ${fileURL}...`);\n        return deleteFile(\n            fileURL,                // File in Pod to Read\n            { fetch: this.fetch }   // fetch from authenticated session\n        );\n    }\n\n    /**\n     * SPARQL\n     */\n    public async sparqlUpdate(fileUrl: string, query: string) {\n    var requestOptions = {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/sparql-update\" },\n        body: query,\n        redirect: \"follow\",\n    };\n    \n        return await this.fetch(fileUrl, requestOptions);\n    }\n\n\n    /**\n     * CONTAINERS\n     */\n\n    public async deleteContainer(containerURL: string, includeSubContainers: boolean = true) {\n\n        // If deleting subcontainers, we need to first get these\n        if(includeSubContainers){\n            console.log(`Deleting container ${containerURL} including its subfolders...`);\n            const dataset = await getSolidDataset( containerURL, { fetch: this.fetch } );\n            const containerResources = await getContainedResourceUrlAll( dataset );\n\n            // Delete resources (containers and files)\n            for(let resource of containerResources){\n                if(isContainer(resource)){\n                    await this.deleteContainer(resource, true);\n                }\n                else{\n                    await this.deleteFile(resource);\n                }\n            }\n        }\n\n        console.log(`Deleting container ${containerURL}...`);\n        return deleteContainer( containerURL, { fetch: this.fetch } );\n        \n    }\n\n    public async createContainer(containerURL: string, makePublic: boolean = false) {\n        \n        this.verbose && console.log(`Creating container ${containerURL}...`);\n\n        const datasetWithAcl = await createContainerAt(\n            containerURL,           // File in Pod to Read\n            { fetch: this.fetch }   // fetch from authenticated session\n        );\n\n        if(makePublic){\n            await this.accessService.makePublic(containerURL);\n        }\n\n        return datasetWithAcl;\n    }\n\n}"],"file":"data-service.js"}