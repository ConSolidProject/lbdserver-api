{"version":3,"sources":["../../../src/helpers/LbdDataset.ts"],"names":["LbdDataset","fetch","url","accessService","AccessService","dataService","DataService","lbdService","LBDService","queryEngine","method","then","result","status","headers","i","json","data","options","makePublic","datasetUrl","res","createContainer","Object","keys","length","q0","key","sparqlUpdate","init","deleteContainer","query","distribution","mimetype","distributionId","distributionUrl","dist","LbdDistribution","create","current","dataset","distributions","DCAT","map"],"mappings":"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","sourcesContent":["import AccessService from \"./access-service\";\nimport DataService from \"./data-service\";\nimport { newEngine, IQueryResultBindings, ActorInitSparql } from \"@comunica/actor-init-sparql\";\n\nimport LBD from \"./vocab/lbd\";\nimport { AccessRights, ResourceType } from \"./BaseDefinitions\";\nimport LBDService from \"./LbdService\";\nimport {extract} from \"jsonld-remote\"\nimport {v4} from \"uuid\"\nimport { DCAT, RDFS } from \"@inrupt/vocab-common-rdf\";\nimport LbdDistribution from './LbdDistribution'\n\nexport default class LbdDataset {\n  public fetch;\n  public accessService: AccessService;\n  public dataService: DataService;\n  public lbdService: LBDService;\n  public projectId: string;\n  public url: string;\n\n  public data: object[];\n\n  // include queryEngine to allow caching of querydata etc.\n  public queryEngine: ActorInitSparql;\n\n  constructor(fetch: any, url) {\n\n    this.fetch = fetch;\n    this.url = url\n    this.accessService = new AccessService(fetch);\n    this.dataService = new DataService(fetch);\n    this.lbdService = new LBDService(fetch);\n    this.queryEngine = newEngine();\n  }\n\n  public async checkExistence() {\n    const status = await this.fetch(this.url, {method: \"HEAD\"}).then(result => result.status)\n    if (status === 200) {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  public async init() {\n    const data = await this.fetch(this.url, {headers: {\"Accept\": \"application/ld+json\"}}).then(i => i.json())\n    this.data = data\n    return data\n  }\n\n  /**\n   * \n   * @param makePublic \n   * @param id\n   * @param options Optional - Object containing metadata about the dataset to be created. e.g: {[RDFS.label]: \"theLabel\"}\n   * @returns \n   */\n  public async create(\n    options: object = {},\n    makePublic: boolean = false,\n  ) {\n    const datasetUrl = this.url\n\n    const status = await this.fetch(datasetUrl, {method: \"HEAD\"}).then(res => res.status)\n    if (status !== 200) {\n      await this.dataService.createContainer(datasetUrl, makePublic)\n    }\n    \n    if (Object.keys(options).length > 0) {\n      let q0 = `INSERT DATA { `\n      for (const key of Object.keys(options)) {\n        q0 += `<${datasetUrl}> <${key}> \"${options[key]}\" .`\n      }    \n      q0 += \"}\"\n      await this.dataService.sparqlUpdate(datasetUrl, q0)\n    }\n    await this.init()\n  }\n\n  public async delete() {\n    await this.dataService.deleteContainer(this.url, true)\n    return\n  }\n\n  public async update(query) {\n      await this.dataService.sparqlUpdate(this.url, query)\n  }\n\n  /////////////////////////////////////////////////////////\n  //////////////////// DISTRIBUTIONS///////////////////////\n  /////////////////////////////////////////////////////////\n  public async addDistribution(distribution: File | Buffer, mimetype? ,options: object = {}, distributionId: string = v4(), makePublic: boolean = false) {      \n    const distributionUrl = this.url + distributionId    \n    const dist = new LbdDistribution(this.fetch, distributionUrl)\n    await dist.create(distribution, {}, mimetype, makePublic)\n    await dist.init()\n    return dist\n  }\n\n  public async getDistributionUrls() {\n      const current = await this.fetch(this.url, {headers: {\"Accept\": \"application/ld+json\"}}).then(res => res.json())\n      const dataset = extract(current, this.url)\n      const distributions = dataset[DCAT.distribution].map(i => i[\"@id\"])\n      return distributions\n  }\n\n  public async deleteDistribution(distributionId: File[]) {\n\n  }\n\n}\n\n"],"file":"LbdDataset.js"}